{{ define "order_detail" }}


<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-8 text-center lg:text-left">
        üõçÔ∏è Detail Pesanan #{{ .Order.OrderCode }}
    </h1>

    {{ if .Message }}
    <div id="flash-message" class="max-w-7xl mx-auto mt-4 px-4 sm:px-6 lg:px-8 animate-fade-in-down">
        <div class="mb-4 p-4 rounded-lg relative flex items-center justify-between shadow-sm
                {{ if eq .MessageStatus "success" }} bg-green-50 border border-green-300 text-green-800
                {{ else if eq .MessageStatus "error" }} bg-red-50 border border-red-300 text-red-800
                {{ else if eq .MessageStatus "warning" }} bg-yellow-50 border border-yellow-300 text-yellow-800
                {{ else }} bg-blue-50 border border-blue-300 text-blue-800
                {{ end }}">
            <span>{{ .Message }}</span>
            <button type="button" class="ml-4 text-gray-700 hover:text-gray-900 focus:outline-none" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    {{ end }}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12 animate-fade-in-up">
        <div class="lg:col-span-1 bg-white shadow-xl rounded-lg p-6 border border-gray-100 h-fit">
            <h2 class="text-2xl font-bold text-gray-800 mb-5 border-b pb-3 border-gray-200">Ringkasan Pesanan</h2>
            <div class="space-y-3 mb-6">
                <div class="flex justify-between items-center text-lg text-gray-700">
                    <span>Status Pesanan</span>
                    <span class="font-semibold px-3 py-1 rounded-full text-sm
                        {{ if eq (.Order.Status | orderStatusText) "Selesai" }} bg-green-100 text-green-800
                        {{ else if eq (.Order.Status | orderStatusText) "Dalam Pengiriman" }} bg-blue-100 text-blue-800
                        {{ else if eq (.Order.Status | orderStatusText) "Sedang Diproses" }} bg-indigo-100 text-indigo-800
                        {{ else if eq (.Order.Status | orderStatusText) "Menunggu Pembayaran" }} bg-yellow-100 text-yellow-800
                        {{ else if eq (.Order.Status | orderStatusText) "Dibatalkan" }} bg-red-100 text-red-800
                        {{ else if eq (.Order.Status | orderStatusText) "Gagal" }} bg-red-100 text-red-800
                        {{ else }} bg-gray-100 text-gray-800
                        {{ end }}">
                        {{ .Order.Status | orderStatusText }}
                    </span>
                </div>
                <div class="flex justify-between items-center text-lg text-gray-700">
                    <span>Status Pembayaran</span>
                    <span class="font-semibold px-3 py-1 rounded-full text-sm
                        {{ if eq (.Order.PaymentStatus | paymentStatusText) "Lunas" }} bg-green-100 text-green-800
                        {{ else if eq (.Order.PaymentStatus | paymentStatusText) "Menunggu Pembayaran" }} bg-yellow-100 text-yellow-800
                        {{ else if eq (.Order.PaymentStatus | paymentStatusText) "Gagal" }} bg-red-100 text-red-800
                        {{ else }} bg-gray-100 text-gray-800
                        {{ end }}">
                        {{ .Order.PaymentStatus | paymentStatusText }}
                    </span>
                </div>
                {{ if .Payment }} 
                    {{ if .Payment.Method }} 
                    <div class="flex justify-between items-center text-lg text-gray-700">
                        <span>Metode Pembayaran</span>
                        <span class="font-semibold">{{ .Payment.Method }}</span>
                    </div>
                    {{ end }}
                {{ end }}
                <div class="flex justify-between items-center text-lg text-gray-700">
                    <span>Tanggal Pesanan</span>
                    <span class="font-semibold">{{ .Order.CreatedAt.Format "02 Jan 2006, 15:04" }}</span>
                </div>
            </div>

            <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2 border-gray-200">Alamat Pengiriman</h3>
            {{ with .Order.Address }}
            <div class="text-gray-700 text-base space-y-1 mb-6">
                <p><strong>{{ .Name }}</strong></p>
                <p>{{ .Address1 }}</p>
                {{ if .Address2 }}<p>{{ .Address2 }}</p>{{ end }}
                <p>{{ .LocationName }}, {{ .PostCode }}</p>
                <p>Telepon: {{ .Phone }}</p>
                <p>Email: {{ .Email }}</p>
            </div>
            {{ else }}
            <p class="text-red-500 text-base mb-6">Alamat pengiriman tidak ditemukan untuk pesanan ini.</p>
            {{ end }}

            
        </div>

        <div class="lg:col-span-2 bg-white shadow-xl rounded-lg p-6 border border-gray-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-5 border-b pb-3 border-gray-200">Daftar Produk</h2>
            <div class="space-y-6 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                {{ if .Order.OrderItems }}
                {{ range .Order.OrderItems }}
                <div class="flex flex-col sm:flex-row items-center sm:items-start justify-between border-b border-gray-200 pb-6 last:border-b-0 last:pb-0 pt-4 animate-fade-in-up">
                    <div class="flex-shrink-0 mr-0 sm:mr-6 mb-4 sm:mb-0">
                        {{ $imageURL := "https://placehold.co/112x112/E0E0E0/333333?text=No+Image" }}
                        {{ if .Product.ProductImages }}
                            {{ range $index, $image := .Product.ProductImages }}
                                {{ if eq $index 0 }}
                                    {{ $imageURL = $image.Path }}
                                {{ end }}
                            {{ end }}
                        {{ end }}
                        <img src="{{ $imageURL }}" alt="{{ .ProductName }}" class="w-28 h-28 object-cover rounded-lg shadow-md border border-gray-100">
                    </div>
                    <div class="flex-1 text-center sm:text-left mb-4 sm:mb-0">
                        <p class="font-semibold text-xl text-gray-800 mb-1">{{ .ProductName }}</p>
                        <p class="text-sm text-gray-600">Jumlah: {{ .Qty }}</p>
                        <p class="text-sm text-gray-600">Harga Satuan: {{ rupiah .Price }}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-lg text-gray-900">{{ rupiah .BaseTotal }}</p>
                    </div>
                </div>
                {{ end }}
                {{ else }}
                <p class="text-gray-600 text-center">Tidak ada produk dalam pesanan ini.</p>
                {{ end }}
            </div>

            <div class="border-t border-gray-200 pt-6 mt-6"></div>

            <h2 class="text-2xl font-bold text-gray-800 mb-5">Total Pembayaran</h2>
            <div class="space-y-3 mb-6">
                <div class="flex justify-between items-center text-lg text-gray-700">
                    <span>Subtotal Produk</span>
                    <span class="font-semibold">{{ rupiah .Order.BaseTotalPrice }}</span>
                </div>
                <div class="flex justify-between items-center text-lg text-gray-700">
                    <span>Diskon</span>
                    <span class="text-emerald-500 font-semibold">-{{ rupiah .Order.DiscountAmount }}</span>
                </div>
                <div class="flex justify-between items-center text-lg text-gray-700">
                    <span>Pajak ({{ .Order.TaxPercent.StringFixed 2 }}%)</span>
                    <span class="text-red-600 font-semibold">+{{ rupiah .Order.TaxAmount }}</span>
                </div>
                <div class="flex justify-between items-center text-lg text-gray-700">
                    <span>Ongkos Kirim ({{ .Order.ShippingServiceCode }} - {{ .Order.ShippingServiceName }})</span>
                    <span class="font-semibold">{{ rupiah .Order.ShippingCost }}</span>
                </div>
                <div class="border-t border-gray-200 pt-4 mt-4"></div>
                <div class="flex justify-between items-center text-2xl font-bold text-gray-900">
                    <span>Total Pembayaran</span>
                    <span class="text-emerald-700">{{ rupiah .Order.GrandTotal }}</span>
                </div>
            </div>

            <div class="mt-8 flex justify-end">
                <a href="/orders" class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200">
                    <i class="fas fa-arrow-left mr-2"></i> Kembali ke Daftar Pesanan
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const flashMessage = document.getElementById('flash-message');
        if (flashMessage) {
            setTimeout(() => {
                flashMessage.classList.add('animate-fade-out');
                flashMessage.addEventListener('animationend', () => {
                    flashMessage.remove();
                });
            }, 5000); // Pesan akan hilang setelah 5 detik
        }
    });
</script>

{{ end }}
